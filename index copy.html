<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BrainLab+ â€“ ×—×§×¨ ×”××•×— ×œ×›×œ ×’×™×œ (×¢× ×× ×™××¦×™×•×ª)</title>
    <style>
        :root {
            --bg: #0b0f24;
            --panel: #13183a;
            --muted: #8fa1d9;
            --text: #eef1ff;
            --accent: #8ab4ff;
            --accent2: #00e1d6;
            --card: #1a1f4b;
            --ok: #43d787;
            --warn: #ffd166;
            --danger: #ff6b6b;
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: "Rubik", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Helvetica, Arial, sans-serif;
            background: radial-gradient(1200px 800px at 75% -10%, #1c2355 0%, #0b0f24 60%), #0b0f24;
            color: var(--text)
        }

        a {
            color: var(--accent)
        }

        .wrap {
            display: grid;
            grid-template-columns: 320px 1fr;
            min-height: 100dvh
        }

        .sidebar {
            background: linear-gradient(180deg, #12183a 0%, #0c1031 100%);
            border-inline-start: 1px solid #232853;
            padding: 20px;
            position: sticky;
            top: 0;
            height: 100dvh;
            overflow: auto
        }

        .main {
            padding: 24px;
        }

        h1 {
            font-size: clamp(26px, 3vw, 42px);
            display: flex;
            align-items: center;
            gap: .6rem;
            margin: 0 0 8px
        }

        .subtitle {
            color: var(--muted);
            margin: 0 0 20px
        }

        .badge {
            display: inline-flex;
            gap: .4rem;
            align-items: center;
            background: linear-gradient(90deg, var(--accent), var(--accent2));
            padding: 6px 10px;
            border-radius: 999px;
            color: #0a1022;
            font-weight: 800
        }

        /* Panels & buttons */
        .panel {
            background: var(--panel);
            border: 1px solid #262b59;
            border-radius: 16px;
            padding: 12px;
            margin-bottom: 16px
        }

        .panel h3 {
            margin: 0 0 10px;
            font-size: 16px;
            color: #c9d2ff
        }

        .btn {
            border: 1px solid #2a3168;
            background: #0f132e;
            color: var(--text);
            padding: 8px 10px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: transform .15s ease
        }

        .btn:active {
            transform: translateY(1px)
        }

        .btn[aria-pressed="true"],
        .btn.active {
            background: linear-gradient(180deg, #262c63, #1a1e4a);
            border-color: #3e4793;
            box-shadow: 0 0 0 2px rgba(122, 162, 255, .25) inset
        }

        .btn.small {
            font-size: 12px;
            padding: 6px 8px
        }

        .btn.ghost {
            background: transparent
        }

        .grid {
            display: grid;
            gap: 14px
        }

        .grid.cols-2 {
            grid-template-columns: repeat(2, 1fr)
        }

        .chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px
        }

        .lvl {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px
        }

        .search {
            display: flex;
            gap: 8px
        }

        .search input {
            flex: 1;
            border: 1px solid #303675;
            background: #0e1332;
            color: var(--text);
            padding: 10px 12px;
            border-radius: 10px
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap
        }

        .tab {
            padding: 10px 12px;
            border: 1px solid #2a3168;
            border-radius: 12px;
            background: #111642;
            color: #dfe5ff;
            cursor: pointer;
            font-weight: 800
        }

        .tab[aria-selected="true"] {
            background: linear-gradient(180deg, #242a62, #171c4b);
            border-color: #3e4793;
        }

        /* Cards */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 16px;
            margin-top: 16px
        }

        .card {
            background: linear-gradient(180deg, #1b1f46, #13173b);
            border: 1px solid #2b3065;
            border-radius: 18px;
            padding: 14px;
            position: relative;
            overflow: hidden
        }

        .card h4 {
            margin: 0 0 6px
        }

        .card p {
            margin: 0;
            color: #cdd3ff
        }

        .pill {
            position: absolute;
            inset-inline-start: 12px;
            top: 12px;
            background: #10153e;
            border: 1px solid #2c3170;
            color: #a9b3ff;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 999px
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px
        }

        .tag {
            font-size: 11px;
            border: 1px dashed #3d4390;
            border-radius: 999px;
            padding: 3px 8px;
            color: #aeb7ff
        }

        /* Brain map */
        .map {
            background: radial-gradient(800px 400px at 60% -20%, rgba(122, 162, 255, .12), transparent 60%), #14183a;
            border: 1px solid #2a3168;
            border-radius: 16px;
            padding: 12px;
            margin-top: 16px
        }

        .brain {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-auto-rows: 50px;
            gap: 6px
        }

        .cell {
            border: 1px solid #384096;
            background: linear-gradient(180deg, #20265b, #171c46);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #cfe1ff;
            cursor: pointer;
            user-select: none;
            transition: transform .2s ease
        }

        .cell:hover {
            transform: translateY(-2px)
        }

        .cell.active {
            outline: 2px solid var(--accent);
            box-shadow: 0 0 0 3px rgba(122, 162, 255, .25)
        }

        /* Drawer / modal */
        dialog {
            border: none;
            border-radius: 16px;
            padding: 0;
            background: #151a3d;
            color: var(--text);
            width: min(760px, 95vw)
        }

        .dialog-head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            border-bottom: 1px solid #2b3065
        }

        .dialog-body {
            padding: 16px
        }

        /* Sections */
        .section {
            margin-top: 22px
        }

        .section h3 {
            margin: 0 0 8px
        }

        .progress {
            height: 10px;
            border-radius: 999px;
            background: #0f1434;
            border: 1px solid #2c3273;
            position: relative;
            overflow: hidden
        }

        .progress>i {
            position: absolute;
            inset-block: 0;
            inset-inline-start: 0;
            background: linear-gradient(90deg, var(--accent), var(--accent2));
            width: 0%
        }

        /* Toggle */
        .toggle {
            display: flex;
            align-items: center;
            gap: 8px
        }

        /* Hero canvas */
        #hero {
            position: relative;
            border: 1px solid #2a3168;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 16px
        }

        #neuroBG {
            position: absolute;
            inset: 0;
            z-index: 0
        }

        #heroTxt {
            position: relative;
            z-index: 1;
            padding: 18px
        }

        /* Animate on view */
        .reveal {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity .5s ease, transform .5s ease
        }

        .reveal.on {
            opacity: 1;
            transform: none
        }

        footer {
            margin-top: 28px;
            color: #9aa1c9;
            font-size: 13px
        }

        @media (max-width: 1040px) {
            .wrap {
                grid-template-columns: 1fr
            }

            .sidebar {
                position: static;
                height: auto
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <!-- SIDEBAR -->
        <aside class="sidebar" aria-label="×¡×¨×’×œ ×¦×“">
            <div class="panel">
                <h3>ğŸ¯ ×¨××ª ×§×”×œ ×”×™×¢×“</h3>
                <div class="lvl">
                    <button class="btn small" data-level="kids">ğŸ‘¶ ×’×Ÿ</button>
                    <button class="btn small" data-level="elem">ğŸ§’ ×™×¡×•×“×™</button>
                    <button class="btn small" data-level="teen">ğŸ§‘â€ğŸ“ ×—×˜"×‘/×ª×™×›×•×Ÿ</button>
                    <button class="btn small" data-level="pro">ğŸ§ª ×—×•×§×¨</button>
                </div>
                <div class="toggle" style="margin-top:10px">
                    <input type="checkbox" id="animTgl" checked />
                    <label for="animTgl">âœ¨ ×”×¤×¢×œ ×× ×™××¦×™×•×ª</label>
                </div>
            </div>
            <div class="panel">
                <h3>ğŸ” ×—×™×¤×•×©</h3>
                <div class="search">
                    <input id="q" type="search" placeholder="×—×¤×©/×™ ×ª××™×, ××–×•×¨×™×, ××•×©×’×™×â€¦" aria-label="×—×™×¤×•×©" />
                    <button class="btn" id="clear">× ×™×§×•×™</button>
                </div>
            </div>
            <div class="panel">
                <h3>ğŸ§¬ ×¡×™× ×•× ×™×</h3>
                <div class="chips" id="filters">
                    <button class="btn small" data-filter="neurons">× ×•×™×¨×•× ×™×</button>
                    <button class="btn small" data-filter="glia">×’×œ×™×”</button>
                    <button class="btn small" data-filter="astro">××¡×˜×¨×•×¦×™×˜×™×</button>
                    <button class="btn small" data-filter="oligo">××•×œ×™×’×•×“× ×“×¨×•×¦×™×˜×™×</button>
                    <button class="btn small" data-filter="micro">××™×§×¨×•×’×œ×™×”</button>
                    <button class="btn small" data-filter="epend">××¤× ×“×™××”</button>
                    <button class="btn small" data-filter="vascular">×›×œ×™ ×“×</button>
                    <button class="btn small" data-filter="inter">××™× ×˜×¨× ×•×™×¨×•× ×™×</button>
                    <button class="btn small" data-filter="pyram">×¤×™×¨××™×“×œ×™×™×</button>
                    <button class="btn small" data-filter="brainstem">×’×–×¢ ×”××•×—</button>
                    <button class="btn small" data-filter="cortex">×§×œ×™×¤×ª ×”××•×—</button>
                    <button class="btn small" data-filter="cerebellum">××•×—×•×Ÿ</button>
                    <button class="btn small" data-filter="hipp">×”×™×¤×•×§××¤×•×¡</button>
                    <button class="btn small" data-filter="amyg">×××™×’×“×œ×”</button>
                    <button class="btn small" data-filter="thalamus">×ª×œ××•×¡</button>
                    <button class="btn small" data-filter="basal">×’×¨×¢×™× ×™ ×”×‘×¡×™×¡</button>
                </div>
            </div>
            <div class="panel">
                <h3>ğŸ§ª × ×™×¡×•×™×™× ×‘×˜×•×—×™× ×‘×‘×™×ª</h3>
                <div class="grid">
                    <button class="btn ghost small" data-open="exps">ğŸ‘‚ ×¨×¤×œ×§×¡×™× ×¤×©×•×˜×™×</button>
                    <button class="btn ghost small" data-open="exps">ğŸ‘ƒ ×˜×¢×™××•×ª ×•×¨×™×—×•×ª</button>
                    <button class="btn ghost small" data-open="exps">ğŸ–ï¸ ××™×©×•×© ×•×©×™×•×•×™ ××©×§×œ</button>
                </div>
            </div>
            <div class="panel">
                <h3>ğŸ“š ××™×œ×•×Ÿ ××•×©×’×™×</h3>
                <button class="btn" data-open="gloss">×¤×ª×— ××™×œ×•×Ÿ</button>
            </div>
            <div class="panel">
                <h3>ğŸ“ˆ ×”×ª×§×“××•×ª</h3>
                <div class="progress" aria-label="×”×ª×§×“××•×ª ×œ××™×“×”"><i id="progBar"></i></div>
                <small id="progTxt">0% ×”×•×©×œ×</small>
            </div>
        </aside>

        <!-- MAIN -->
        <main class="main" aria-live="polite">
            <section id="hero" class="reveal on" aria-label="×›×•×ª×¨×ª ×’×¨×¤×™×ª">
                <canvas id="neuroBG" aria-hidden="true"></canvas>
                <div id="heroTxt">
                    <h1>ğŸ§  BrainLab+ â€“ ×—×§×¨ ×”××•×—</h1>
                    <p class="subtitle">×œ××™×“×” ×¨×‘-×©×›×‘×ª×™×ª ×¢× <span class="badge">××¦×‘ ×™×œ×“×™× ğŸ‘¶</span>, ×× ×™××¦×™×•×ª ×¢×“×™× ×•×ª,
                        ×•×¡×¤×¨×™×™×ª ×ª×›× ×™× ××ª×¨×—×‘×ª.</p>
                </div>
            </section>

            <!-- Tabs -->
            <nav class="tabs" role="tablist" aria-label="×›×¨×˜×™×¡×™×•×ª ×ª×•×›×Ÿ">
                <button class="tab" role="tab" aria-selected="true" data-tab="cells">ğŸ§« ×ª××™×</button>
                <button class="tab" role="tab" aria-selected="false" data-tab="regions">ğŸ—ºï¸ ××–×•×¨×™×</button>
                <button class="tab" role="tab" aria-selected="false" data-tab="systems">ğŸ”— ××¢×¨×›×•×ª</button>
                <button class="tab" role="tab" aria-selected="false" data-tab="activities">ğŸ² ×¤×¢×™×œ×•×™×•×ª &
                    ×—×™×“×•× ×™×</button>
                <button class="tab" role="tab" aria-selected="false" data-tab="tracks">ğŸ›¤ï¸ ××¡×œ×•×œ×™ ×œ×™××•×“</button>
            </nav>

            <!-- Content placeholder -->
            <section id="content" class="reveal"></section>

            <!-- Brain map (regions tab extra) -->
            <section id="mapWrap" class="map reveal" hidden>
                <h3>ğŸ§  ××¤×ª ××•×— ××™× ×˜×¨××§×˜×™×‘×™×ª</h3>
                <div class="brain" id="brainGrid" aria-label="××¤×ª ×”××•×—">
                    <div class="cell" data-region="frontal">××•× ×” ××¦×—×™×ª</div>
                    <div class="cell" data-region="parietal">××•× ×” ×§×•×“×§×•×“×™×ª</div>
                    <div class="cell" data-region="temporal">××•× ×” ×¨×§×ª×™×ª</div>
                    <div class="cell" data-region="occipital">××•× ×” ×¢×•×¨×¤×™×ª</div>
                    <div class="cell" data-region="cerebellum">××•×—×•×Ÿ</div>
                    <div class="cell" data-region="brainstem">×’×–×¢ ×”××•×—</div>
                    <div class="cell" data-region="thalamus">×ª×œ××•×¡</div>
                    <div class="cell" data-region="basal">×’×¨×¢×™× ×™ ×‘×¡×™×¡</div>
                    <div class="cell" data-region="hipp">×”×™×¤×•×§××¤×•×¡</div>
                    <div class="cell" data-region="amyg">×××™×’×“×œ×”</div>
                </div>
            </section>

            <!-- Tracks -->
            <section id="tracksWrap" class="section reveal" hidden>
                <h3>ğŸ›¤ï¸ ××¡×œ×•×œ×™ ×œ×™××•×“ ×œ×¤×™ ×’×™×œ</h3>
                <div class="cards" id="tracksCards"></div>
            </section>

            <footer>
                × ×‘× ×” ×‘××”×‘×” ×œ×—×§×¨ ×”××•×— â€“ ×ª×•×›×Ÿ ×—×™× ×•×›×™ ×‘×©×œ×‘×™× ğŸ‘¶ğŸ§’ğŸ§‘â€ğŸ“ğŸ§ª | ×˜×™×¤: ×›×‘×•/×”×¤×¢×™×œ×• ×× ×™××¦×™×•×ª ××”×¡×™×™×“×‘×¨.
            </footer>
        </main>
    </div>

    <!-- Dialogs -->
    <dialog id="dlgGloss">
        <div class="dialog-head">
            <strong>ğŸ“š ××™×œ×•×Ÿ ××•×©×’×™×</strong>
            <button class="btn small" data-close>×¡×’×™×¨×”</button>
        </div>
        <div class="dialog-body" id="glossBody"></div>
    </dialog>

    <dialog id="dlgExps">
        <div class="dialog-head">
            <strong>ğŸ§ª × ×™×¡×•×™×™× ×‘×˜×•×—×™×</strong>
            <button class="btn small" data-close>×¡×’×™×¨×”</button>
        </div>
        <div class="dialog-body" id="expsBody"></div>
    </dialog>

    <!-- Three.js -->
    <script src="https://unpkg.com/three@0.159.0/build/three.min.js"></script>

    <script>
        // ---------- DATA ----------
        const LEVELS = ["kids", "elem", "teen", "pro"]; // ×¡×“×¨ ×¢×•×œ×”

        const cells = [
            {
                id: "neuron", kind: ["neurons"], title: "× ×•×™×¨×•×Ÿ (×ª× ×¢×¦×‘) ğŸ§ âš¡",
                tags: ["×“× ×“×¨×™×˜×™×", "××§×¡×•×Ÿ", "×¡×™× ×¤×¡×”"],
                text: { kids: "×”×ª× ×©×©×•×œ×— ×”×•×“×¢×•×ª ×§×˜× ×˜× ×•×ª ×‘×’×•×£ â€“ ×›××• ×©×œ×™×—×™× ×¢× ×‘×¨×§×™×.", elem: "×ª× ×©××¢×‘×™×¨ ××•×ª×•×ª ×—×©××œ×™×™× ×•×›×™××™×™×. ×™×© ×œ×• ×“× ×“×¨×™×˜×™× ×œ×§×œ×™×˜×” ×•××§×¡×•×Ÿ ×œ×©×œ×™×—×”.", teen: "× ×•×™×¨×•×Ÿ ×™×•×¦×¨ ×¤×•×˜× ×¦×™××œ ×¤×¢×•×œ×” ×•××ªÖ´×§×©×¨ ×“×¨×š ×¡×™× ×¤×¡×•×ª ×‘×¢×–×¨×ª × ×•×™×¨×•×˜×¨× ×¡××™×˜×¨×™×.", pro: "×ª× ××¢×•×¨×¨/××¢×›×‘ ×”××©×œ×‘ ×§×œ×˜×™× ×¡×™× ×¤×˜×™×™× ×œ×—×™×©×•×‘ ×¡×£; ×”×•×œ×›×” ××œ×—×™×ª ×œ××•×¨×š ××§×¡×•×Ÿ ×¢×˜×•×£ ××™××œ×™×Ÿ." }
            },
            {
                id: "pyram", kind: ["neurons", "pyram"], title: "× ×•×™×¨×•×Ÿ ×¤×™×¨××™×“×œ×™ â–²",
                tags: ["×§×•×¨×˜×§×¡", "×’×œ×•×˜××˜"],
                text: { kids: "×ª× ×¢×¦×‘ ×‘×¦×•×¨×ª ×¤×™×¨××™×“×” ×©×¢×•×–×¨ ×œ×—×©×•×‘ ×•×œ×–×•×–.", elem: "× ×•×™×¨×•×Ÿ ×¢×™×§×¨×™ ××¢×•×¨×¨ ×‘×§×œ×™×¤×ª ×”××•×—.", teen: "×©×œ×•×—×•×ª ××¨×•×›×•×ª ×‘×™×Ÿ ××–×•×¨×™ ×§×•×¨×˜×§×¡; ×¤×œ×¡×˜×™×•×ª ×—×–×§×”.", pro: "×©×›×‘×•×ª V/III; ×§×™×©×•×¨×™×•×ª ×œ×˜×•×•×— ××¨×•×š; ×ª×¤×§×™×“ ××¨×›×–×™ ×‘×ª×¤×§×•×“×™× × ×™×”×•×œ×™×™×." }
            },
            {
                id: "inter", kind: ["neurons", "inter"], title: "××™× ×˜×¨× ×•×™×¨×•×Ÿ (GABA) ğŸ§©",
                tags: ["×¢×™×›×•×‘", "××™×–×•×Ÿ"],
                text: { kids: "×ª××™ ×‘×œ××™× ×©×©×•××¨×™× ×¢×œ ×©×§×˜ ×›×©×¦×¨×™×š.", elem: "××¢×›×‘×™× ×¤×¢×™×œ×•×ª â€“ ×©×•××¨×™× ×¢×œ ××™×–×•×Ÿ.", teen: "×¡×•×’×™×: ×¤×¨×‘××œ×‘×•××™×Ÿ, SOM, VIP; ×ª×–××•×Ÿ ×¨×™×ª××™.", pro: "××¢×’×œ×™ feedforward/feedback; ×¢×™×¦×•×‘ ×—×œ×•× ×•×ª ×¤×œ×¡×˜×™×•×ª ×•×§×™×“×•×“ ×ª×–××•× ×™." }
            },
            {
                id: "astro", kind: ["glia", "astro"], title: "××¡×˜×¨×•×¦×™×˜ â­",
                tags: ["×ª××™×›×”", "×ª×–×•× ×”", "×“×-××•×—"],
                text: { kids: "×ª××™ ×¢×–×¨×” ×©×××›×™×œ×™× ×•×©×•××¨×™× ×¢×œ ×”× ×•×™×¨×•× ×™×.", elem: "×©×•××¨×™× ×¢×œ ×¡×‘×™×‘×” ×›×™××™×ª × ×›×•× ×” ×•××¡×™×™×¢×™× ×‘×—×•××ª ×“×-××•×—.", teen: "××¡×œ×§×™× × ×•×™×¨×•×˜×¨× ×¡××™×˜×¨×™×, ×××–× ×™× ×™×•× ×™×, ×•×ª×•×¨××™× ×œ×¤×œ×¡×˜×™×•×ª ×¡×™× ×¤×˜×™×ª.", pro: "××¡×˜×¨×•×¦×™×˜×™× ××‘×˜××™× GFAP; ×¨×’×•×œ×¦×™×™×ª K+ ×•×”×˜×¨×•-×¡×™× ×¤×˜×™×§ ××•×“×•×œ×¦×™×” ×“×¨×š ×˜×¨×™×¤××¨×˜×™×˜ ×¡×™× ×¤×¡." }
            },
            {
                id: "oligo", kind: ["glia", "oligo"], title: "××•×œ×™×’×•×“× ×“×¨×•×¦×™×˜ ğŸ§²",
                tags: ["××™××œ×™×Ÿ", "××”×™×¨×•×ª"],
                text: { kids: "××œ×‘×™×© ××ª ×›×‘×œ×™ ×”×¢×¦×‘×™× ×‘××¢×˜×¤×ª ×©×¢×•×–×¨×ª ×œ××”×™×¨×•×ª.", elem: "×™×•×¦×¨ ××™××œ×™×Ÿ ×‘-CNS ×•×›×š ××–×¨×– ×”×•×œ×›×” ×¢×¦×‘×™×ª.", teen: "××œ×›×“ ×¡×’×× ×˜×™× ×œ××•×¨×š ××§×¡×•× ×™× ××¨×•×‘×™×; ×”×•×œ×›×” ××œ×—×™×ª ×‘×™×Ÿ ×’×©×¨×™ ×¨× ×•×™×™×”.", pro: "××™××œ×™× ×™×–×¦×™×” ×“×™× ××™×ª ××•×•×¡×ª×ª ×¢×™×ª×•×™ ×¨×©×ª×•×ª; ×¤×’×™×¢×” ××•×‘×™×œ×” ×œ×™×¨×™×“×” ×‘××”×™×¨×•×ª." }
            },
            {
                id: "micro", kind: ["glia", "micro"], title: "××™×§×¨×•×’×œ×™×” ğŸ›¡ï¸",
                tags: ["×—×™×¡×•×Ÿ", "× ×™×§×•×™"],
                text: { kids: "×©×•××¨×™ ×”×™×¢×¨ ×©×œ ×”××•×— â€“ ×× ×§×™× ×•××’× ×™×.", elem: "×ª××™ ×—×™×¡×•×Ÿ ×ª×•×©×‘×™-××•×— ×©××–×”×™× × ×–×§ ×•××¡×™×¨×™× ×¤×¡×•×œ×ª.", teen: "×¤××’×•×¦×™×˜×•×–×”, ×¢×™×¦×•×‘ ××¢×’×œ×™× ×‘×¡×™× ×¤×¡×•×ª, ×¦×™×˜×•×§×™× ×™×.", pro: "××§×•×¨ ×™×•×œ×“×™ ×©×§-×—×œ××•×Ÿ; ××¦×‘×™ M1/M2; ×ª×¨×•××ª× ×œ×”×•×××•×¡×˜×–×™×¡ ×•×œ×¤×ª×•×œ×•×’×™×”." }
            },
            {
                id: "schwann", kind: ["glia"], title: "×ª××™ ×©×•×•××Ÿ ğŸ§µ (PNS)",
                tags: ["××™××œ×™×Ÿ ×¤×¨×™×¤×¨×™", "×ª×™×§×•×Ÿ"],
                text: { kids: "×¢×•×–×¨ ×œ×¢×¦×‘×™× ××—×•×¥ ×œ××•×— ×œ×”×—×œ×™×.", elem: "××™××œ×™×Ÿ ×‘××¢×¨×›×ª ×”×¢×¦×‘×™× ×”×”×™×§×¤×™×ª ×•×ª××™×›×” ×‘×”×ª×—×“×©×•×ª.", teen: "××™××œ×™× ×™×–×¦×™×” ××—×“-×œ××—×“; ×ª×¢×œ×•×ª × ×•×“××œ×™×•×ª.", pro: "×ª×¤×§×™×“×™× ×‘×¨×’× ×¨×¦×™×” ××§×¡×•× ×œ×™×ª, ×”×¤×¨×©×ª ×’×•×¨××™ ×’×“×™×œ×” ×•×”×›×•×•× ×ª × ×‘×™×˜×”." }
            },
            {
                id: "epend", kind: ["glia", "epend"], title: "××¤× ×“×™××” ğŸ’§",
                tags: ["CSF", "× ×™×§×•×–"],
                text: { kids: "×ª××™× ×©××¦×¤×™× ××ª ×”×× ×”×¨×•×ª ×©×œ ××™ ×”××•×—.", elem: "××¦×¤×™× ×—×“×¨×™ ××•×— ×•××¡×™×™×¢×™× ×‘×–×¨×™××ª ×”-CSF.", teen: "×¨×™×¡×™× ××–×¨×™××™× × ×•×–×œ; ××—×¡×•× ×¡×œ×§×˜×™×‘×™.", pro: "×¨×’×•×œ×¦×™×™×ª × ×•×–×œ ××•×—-×©×“×¨×” ×•×ª×—×–×•×§×ª × ×™×©×” × ×•×™×¨×•×’× ×™×ª." }
            },
            {
                id: "endot", kind: ["vascular"], title: "×× ×“×•×ª×œ ×›×œ×™ ×“× ğŸ©¸",
                tags: ["BBB", "××¡×¤×§×”"],
                text: { kids: "×”×¦×™× ×•×¨×•×ª ×©××‘×™××™× ×œ××•×— ××•×›×œ ×•×—××¦×Ÿ.", elem: "×“×¤× ×•×ª ×›×œ×™ ×”×“× ×•×—×•××ª ×“×-××•×—.", teen: "×¦××ª×™× ×”×“×•×§×™×, ×ª×—×‘×•×¨×” ×¡×œ×§×˜×™×‘×™×ª.", pro: "×˜×¨× ×¡×¦×™×˜×•×–×” ×¨×’×•×œ×˜×•×¨×™×ª ×•××™×§×¨×•-×•×¡×§×•×œ×¨×™×–×¦×™×” ×§×•×¨×˜×™×§×œ×™×ª." }
            },
            {
                id: "pericyte", kind: ["vascular"], title: "×¤×¨×™×¦×™×˜×™× ğŸ”’",
                tags: ["×ª××™×›×”", "×–×¨×™××”"],
                text: { kids: "×©×•××¨×™× ×©×”× ×”×¨×•×ª ×©×œ ×”×“× ×™×–×¨××• × ×›×•×Ÿ.", elem: "×ª××™ ×ª××š ×¢×œ ×§×¤×™×œ×¨×•×ª ××•×•×¡×ª×™× ×–×¨×™××”.", teen: "×‘×§×¨×” ×¢×œ BBB ×•×ª×™×§×•×Ÿ ×›×œ×™ ×“×.", pro: "××•×ª×•×ª PDGFRÎ²; ×ª×¤×§×™×“×™× ×‘×× ×’'×™×•×’× ×–×” ×•× ×–×§ ××™×¡×›××™." }
            },
            {
                id: "purk", kind: ["neurons", "cerebellum"], title: "×ª× Purkinje âš–ï¸",
                tags: ["××•×—×•×Ÿ", "×ª×–××•×Ÿ"],
                text: { kids: "×××¡×˜×¨ ×©×œ ×“×™×•×§ ×‘×ª× ×•×¢×”.", elem: "×ª× ×¢×™×§×¨×™ ××¢×›×‘ ×‘××•×—×•×Ÿ.", teen: "×§×œ×˜ ×¢× ×¤×™× ××§×‘×™×œ×™× ×•-Climbing fibers.", pro: "×œ××™×“×ª ×©×’×™××” ×¡×™× ×¤×˜×™×ª ×•×™×¦×™×‘×•×ª ×ª×–××•× ×™× ××•×˜×•×¨×™×™×." }
            },
        ];

        const regions = [
            { id: "frontal", kind: ["cortex"], title: "××•× ×” ××¦×—×™×ª ğŸ§­", tags: ["×ª×›× ×•×Ÿ", "×©×œ×™×˜×”"], text: { kids: "××¨×›×– ×”×ª×›× ×•×Ÿ â€“ ××—×œ×™×˜ ××” ×¢×•×©×™×.", elem: "×§×‘×œ×ª ×”×—×œ×˜×•×ª, ×©×œ×™×˜×” ×‘×ª× ×•×¢×”, ×ª×›× ×•×Ÿ.", teen: "×ª×¤×§×•×“×™× × ×™×”×•×œ×™×™×, ×§×•×¨×˜×§×¡ ×¤×¨×”-×¤×¨×•× ×˜×œ×™.", pro: "×‘×§×¨×ª ×¢×›×‘×•×ª, ×¢×‘×•×“×” ×‘×–×™×›×¨×•×Ÿ (DLPFC), ××–×•×¨ ××•×˜×•×¨×™ ×¨××©×™ M1." } },
            { id: "parietal", kind: ["cortex"], title: "××•× ×” ×§×•×“×§×•×“×™×ª ğŸ—ºï¸", tags: ["×—×™×©×”", "××¨×—×‘"], text: { kids: "××¨×’×™×©×” ××’×¢ ×•×›×™×•×•×Ÿ.", elem: "×¢×™×‘×•×“ ××’×¢, ×˜××¤×¨×˜×•×¨×” ×•××™×§×•× ×‘××¨×—×‘.", teen: "×©×™×œ×•×‘ ×¡× ×¡×•×¨×™; ×§×©×‘ ××¨×—×‘×™.", pro: "S1, S2 ×¢×™×‘×•×“ ×¡×•××˜×•×¡× ×¡×•×¨×™; ××¤×•×ª ×”×•××•× ×§×•×œ×•×¡." } },
            { id: "temporal", kind: ["cortex"], title: "××•× ×” ×¨×§×ª×™×ª ğŸµ", tags: ["×©××¢", "×©×¤×”", "×–×™×›×¨×•×Ÿ"], text: { kids: "×©×•××¢×ª ×•×¢×•×–×¨×ª ×œ×–×›×•×¨.", elem: "×©××™×¢×” ×•×©×™×•×; ×”×™×¤×•×§××¤×•×¡ ×§×¨×•×‘.", teen: "××–×•×¨×™× ×œ×©×¤×” (×•×•×¨× ×™×§×”); ×§×™×“×•×“ ×–×™×›×¨×•× ×•×ª.", pro: "TL ××“×™××œ×™ ×œ×–×™×›×¨×•×Ÿ ××¤×™×–×•×“×™; ×¢×™×‘×•×“ ××•×“×™×˜×•×¨×™ ×¨××©×•× ×™ A1." } },
            { id: "occipital", kind: ["cortex"], title: "××•× ×” ×¢×•×¨×¤×™×ª ğŸ‘ï¸", tags: ["×¨××™×™×”"], text: { kids: "××¦×™×™×¨×ª ×œ× ×• ××ª ××” ×©×¨×•××™×.", elem: "×¢×™×‘×•×“ ×¨××™×™×ª×™ ×‘×¡×™×¡×™.", teen: "××¡×œ×•×œ×™ ××”/××™×¤×” (ventral/dorsal).", pro: "V1-V5, ××™×¤×•×™ ×¨×˜×™× ×•-×˜×•×¤×™ ×•×–×¨×™××•×ª ××™×“×¢ ×—×–×•×ª×™×•×ª." } },
            { id: "cerebellum", kind: ["cerebellum"], title: "××•×—×•×Ÿ âš–ï¸", tags: ["××™×–×•×Ÿ", "×“×™×•×§"], text: { kids: "×©×•××¨ ×©×œ× × ×ª× ×“× ×“.", elem: "×ª×™××•× ×ª× ×•×¢×” ×•×©×™×•×•×™ ××©×§×œ.", teen: "×§×•××•×¨×“×™× ×¦×™×”, ×œ××™×“×ª ×©×’×™××•×ª.", pro: "××“×¤×˜×¦×™×” ××•×˜×•×¨×™×ª ×“×¨×š Purkinje, ×”×©×•×•××ª ×§×œ×˜×™× ×ª×—×•×©×ª×™×™×." } },
            { id: "brainstem", kind: ["brainstem"], title: "×’×–×¢ ×”××•×— ğŸŒ¿", tags: ["× ×©×™××”", "×“×•×¤×§"], text: { kids: "×“×•××’ ×œ× ×©×•× ×•×œ×¤×¢×•×.", elem: "××¨×›×–×™× ×—×™×•× ×™×™× ×•×©×™×“×•×¨ ××•×ª×•×ª.", teen: "×¤×•×¨××˜×™×• ×¨×˜×™×§×•×œ×¨×™×¡, ××¡×™×œ×•×ª ×¡× ×¡×•-××•×˜×•×¨×™×•×ª.", pro: "×’×¨×¢×™× ×™×, ×¢×¦×‘×™× ×§×¨× ×™××œ×™×™×, ×‘×§×¨×ª ×¢×¨×•×ª ×•×œ×™×‘×” ××•×˜×•× ×•××™×ª." } },
            { id: "hipp", kind: ["hipp"], title: "×”×™×¤×•×§××¤×•×¡ ğŸ”", tags: ["×–×™×›×¨×•×Ÿ"], text: { kids: "×Ö°×¡Ö·×“ÖµÖ¼×¨ ×¡×™×¤×•×¨×™× ×‘×–×™×›×¨×•×Ÿ.", elem: "××¢×‘×™×¨ ×–×™×›×¨×•×Ÿ ×§×¦×¨ ×œ××¨×•×š.", teen: "LTP, ×§×™×“×•×“ ××¨×—×‘×™ ×•× ×•×™×¨×•×’× ×–×”.", pro: "×“× ×˜×™×™×˜ ×’'×™×™×¨×•×¡, CA1/CA3, ×§×•× ×¡×•×œ×™×“×¦×™×” ×•×–×™×›×¨×•×Ÿ ××¨×—×‘×™." } },
            { id: "amyg", kind: ["amyg"], title: "×××™×’×“×œ×” â¤ï¸â€ğŸ”¥", tags: ["×¨×’×©", "×¡×›× ×”"], text: { kids: "×¤×¢××•×Ÿ ×”××–×”×¨×” ×•×”×¨×’×©×•×ª.", elem: "×–×™×”×•×™ ×¤×—×“ ×•×”×‘×¢×•×ª.", teen: "×§×©×™×¨×” ×¨×’×©×™×ª ×œ×–×™×›×¨×•× ×•×ª.", pro: "×’×¨×¢×™× ×™× ×œ×˜×¨××œ×™×™×/×‘×¡×•×œ×˜×¨××œ×™×™×; ××•×“×•×œ×¦×™×™×ª ×ª×’×•×‘×ª ×¡×˜×¨×¡." } },
            { id: "thalamus", kind: ["thalamus"], title: "×ª×œ××•×¡ ğŸ”€", tags: ["×××¡×¨"], text: { kids: "×ª×—× ×ª ××¢×‘×¨ ×œ×—×•×©×™×.", elem: "×ª×—× ×ª ×××¡×¨ ×œ×§×•×¨×˜×§×¡.", teen: "×¡×™× ×•×Ÿ ×§×©×‘× ×™ ×œ××¡×œ×•×œ×™×.", pro: "×’×¨×¢×™× ×™× ×¡×¤×¦×™×¤×™×™× ×•×œ×-×¡×¤×¦×™×¤×™×™×; ××™× ×˜×’×¨×¦×™×” ×¡× ×¡×•-××•×˜×•×¨×™×ª." } },
            { id: "basal", kind: ["basal"], title: "×’×¨×¢×™× ×™ ×”×‘×¡×™×¡ ğŸ›ï¸", tags: ["×ª× ×•×¢×”", "×”×¨×’×œ"], text: { kids: "×¢×•×–×¨×™× ×œ×”×ª×—×™×œ ×•×œ×¢×¦×•×¨ ×ª× ×•×¢×•×ª.", elem: "××¢×’×œ×™× ×œ×”×¨×’×œ×™× ×•×ª× ×•×¢×”.", teen: "××¡×œ×•×œ×™× ×™×©×™×¨/×¢×§×™×£ (D1/D2).", pro: "×¡×œ×§×¦×™×™×ª ×¤×¢×•×œ×•×ª, ×—×™×–×•×§ ×“×•×¤××™× ×¨×’×™ ×•-learning ××‘×•×¡×¡ ×ª×’××•×œ." } },
        ];

        const systems = [
            { id: "sensory", title: "××¢×¨×›×ª ×—×™×©×” ğŸ‘ƒğŸ‘‚ğŸ‘€", tags: ["×§×œ×™×˜×”", "××’×¢", "×˜×¢×"], text: { kids: "×”×—×•×©×™× ××¡×¤×¨×™× ×œ××•×— ××” ×§×•×¨×”.", elem: "×¢×™×‘×•×“ ××™×“×¢ ××—×•×©×™× ×©×•× ×™×.", teen: "××¡×œ×•×œ×™× ×ª×—×•×©×ª×™×™× ×•×¢×œ×™×•× ×•×ª ×§×•×¨×˜×™×§×œ×™×ª.", pro: "×˜×¨× ×¡×“×•×§×¦×™×”, ×§×™×“×•×“, ×•×©×™×œ×•×‘ ×‘×™×Ÿ-×—×•×©×™." } },
            { id: "motor", title: "××¢×¨×›×ª ×ª× ×•×¢×” ğŸƒ", tags: ["×©×¨×™×¨×™×", "×ª×›× ×•×Ÿ"], text: { kids: "××•××¨×ª ×œ×©×¨×™×¨×™× ×œ×–×•×–.", elem: "×××¡×“ ×¤×™×¨××™×“×œ×™ ×•×—×•×¥-×¤×™×¨××™×“×œ×™.", teen: "×’×¨×¢×™× ×™ ×‘×¡×™×¡, ××•×—×•×Ÿ ×•×ª×›× ×•×Ÿ ×ª× ×•×¢×”.", pro: "×ª×›× ×™×•×ª ××•×˜×•×¨×™×•×ª, ×ª×™×§×•×Ÿ ×¤×™×“×‘×§ ×•×”×•×¦××” ×œ×¤×•×¢×œ." } },
            { id: "memory", title: "××¢×¨×›×ª ×–×™×›×¨×•×Ÿ ğŸ§©", tags: ["×§×™×“×•×“", "×©×œ×™×¤×”"], text: { kids: "×–×•×›×¨×ª ×“×‘×¨×™× ×—×©×•×‘×™×.", elem: "×¡×•×’×™ ×–×™×›×¨×•×Ÿ: ×§×¦×¨/××¨×•×š.", teen: "××¤×™×–×•×“×™, ×¡×× ×˜×™, ×¤×¨×•×¦×“×•×¨×œ×™.", pro: "LTP/LTD, ××¢×’×œ×™ ×”×™×¤×•×§××¤×•×¡-×§×œ×™×¤×ª×™×™×." } },
            { id: "language", title: "×©×¤×” ğŸ—£ï¸", tags: ["×“×™×‘×•×¨", "×”×‘× ×”"], text: { kids: "×¢×•×–×¨×ª ×œ× ×• ×œ×“×‘×¨ ×•×œ×”×‘×™×Ÿ.", elem: "××–×•×¨×™× ×œ×©×¤×” ×§×•×¨×˜×™×§×œ×™×ª.", teen: "×‘×¨×•×§×” ××•×œ ×•×•×¨× ×™×§×”.", pro: "×§×™×©×•×¨×™×•×ª ×¤×¨×•× ×˜×•-×˜××¤×•×¨×œ×™×ª ×•×¤×œ×¡×˜×™×•×ª ×œ×©×•× ×™×ª." } },
            { id: "emotion", title: "×¨×’×© ğŸ’", tags: ["××•×˜×™×‘×¦×™×”", "×ª×’××•×œ"], text: { kids: "×œ×”×¨×’×™×© ×©××—×” ××• ×¤×—×“.", elem: "×××™×’×“×œ×” ×•××¢×’×œ ×ª×’××•×œ.", teen: "×“×•×¤××™×Ÿ, ×¡×¨×•×˜×•× ×™×Ÿ ×•×¨×©×ª ×‘×¨×™×¨×ª-××—×“×œ.", pro: "××¢×’×œ ×œ×™××‘×™, VTA-NAc ×•××•×“×•×œ×¦×™×” ×§×•×¨×˜×™×§×œ×™×ª." } },
            { id: "attention", title: "×§×©×‘ ğŸ”¦", tags: ["××™×§×•×“", "×‘×—×™×¨×”"], text: { kids: "×œ×‘×—×•×¨ ×‘××” ×œ×”×¡×ª×›×œ.", elem: "××¡× × ×™× ××™×“×¢ ×—×©×•×‘.", teen: "×¨×©×ª×•×ª ×§×©×‘: ×§×“××™×ª/××—×•×¨×™×ª.", pro: "SAL/DMN/FPN â€“ ×“×™× ××™×§×ª ×¨×©×ª×•×ª ×•×ª× ×•×“×•×ª × ×•×™×¨×•× ×™×•×ª." } },
        ];

        const activities = [
            {
                id: "quiz_cells", title: "ğŸ§ª ×—×™×“×•×Ÿ: ××™ ×× ×™? (×ª××™×)", level: "elem", q: [
                    { t: "××™×–×” ×ª× ×¢×•×˜×£ ××§×¡×•× ×™× ×‘××¢×˜×¤×ª ××™××œ×™×Ÿ ×‘-CNS?", a: ["××¡×˜×¨×•×¦×™×˜", "××•×œ×™×’×•×“× ×“×¨×•×¦×™×˜", "××™×§×¨×•×’×œ×™×”"], ok: 1 },
                    { t: "××™×–×” ×ª× ×”×•× ×‘×œ× ××¢×›×‘?", a: ["× ×•×™×¨×•×Ÿ ×¤×™×¨××™×“×œ×™", "××™× ×˜×¨× ×•×™×¨×•×Ÿ GABA", "×ª× ×©×•×•××Ÿ"], ok: 1 }
                ]
            },
            {
                id: "quiz_regions", title: "ğŸ§­ ×—×™×“×•×Ÿ: ××–×•×¨×™ ××•×—", level: "teen", q: [
                    { t: "×”×™×›×Ÿ × ××¦××ª ×”××¤×” ×”××•×˜×•×¨×™×ª ×”×¨××©×™×ª?", a: ["××•× ×” ×¨×§×ª×™×ª", "××•× ×” ××¦×—×™×ª", "××•×—×•×Ÿ"], ok: 1 },
                    { t: "××™ ×§×©×•×¨ ×™×•×ª×¨ ×œ×¤×—×“?", a: ["×××™×’×“×œ×”", "×”×™×¤×•×§××¤×•×¡", "×ª×œ××•×¡"], ok: 0 }
                ]
            },
        ];

        const tracks = [
            { id: "t_kids", age: "ğŸ‘¶ ×’×Ÿ", steps: ["×”×™×›×¨×•×ª ×¢× ×—×•×©×™×", "××©×—×§ '××¦× ××ª ×”×¨×™×—'", "×¦×™×•×¨ ××•×— ×‘×©× ×™ ×¦×‘×¢×™×", "× ×™×¡×•×™ × ×§×•×“×ª ×¢×™×•×•×¨×•×Ÿ"] },
            { id: "t_elem", age: "ğŸ§’ ×™×¡×•×“×™", steps: ["×ª××™× ×‘×¡×™×¡×™×™× (× ×•×™×¨×•×Ÿ/×’×œ×™×”)", "××¤×ª ××•×— ×¤×©×•×˜×”", "× ×™×¡×•×™ ×¨×¤×œ×§×¡ ×¤×™×§×”", "×—×™×“×•×Ÿ ×ª××™× ×§×¦×¨"] },
            { id: "t_teen", age: "ğŸ§‘â€ğŸ“ ×ª×™×›×•×Ÿ", steps: ["××¡×œ×•×œ×™ ××”/××™×¤×” ×‘×¨××™×™×”", "×’×¨×¢×™× ×™ ×‘×¡×™×¡ â€“ ×™×©×™×¨/×¢×§×™×£", "LTP ×•×”×™×¤×•×§××¤×•×¡", "×¤×¨×•×™×§×˜ ××¦×’×ª ×¡×™×›×•×"] },
            { id: "t_pro", age: "ğŸ§ª ×—×•×§×¨", steps: ["×“×™× ××™×§×ª ×¨×©×ª×•×ª (DMN/SAL/FPN)", "××•×“×œ×™× ×—×™×©×•×‘×™×™×", "×›×ª×™×‘×ª ×¡×§×™×¨×” ×§×¦×¨×”", "×”×¦×’×ª ×¤×•×¡×˜×¨"] },
        ];

        const glossary = [
            { term: "×¡×™× ×¤×¡×”", def: "× ×§×•×“×ª ××¤×’×© ×‘×™×Ÿ ×ª××™× ×©×‘×” ××•×¢×‘×¨ ××•×ª ×›×™××™/×—×©××œ×™." },
            { term: "×“× ×“×¨×™×˜", def: "×©×œ×•×—×” ×§×•×œ×˜×ª ×§×œ×˜ ×‘× ×•×™×¨×•×Ÿ." },
            { term: "××§×¡×•×Ÿ", def: "×©×œ×•×—×” ××©×“×¨×ª ×©×œ × ×•×™×¨×•×Ÿ." },
            { term: "××™××œ×™×Ÿ", def: "××¢×˜×¤×ª ×‘×™×“×•×“ ×”×××™×¦×” ×”×•×œ×›×” ×¢×¦×‘×™×ª." },
            { term: "× ×•×™×¨×•×˜×¨× ×¡××™×˜×¨", def: "×—×•××¨ ×›×™××™ ×©××¢×‘×™×¨ ××¡×¨ ×‘×™×Ÿ ×ª××™×." },
        ];

        const experiments = [
            { title: "ğŸ‘€ × ×§×•×“×ª ×¢×™×•×•×¨×•×Ÿ", how: "×¦×™×™×¨×• × ×§×•×“×” ×•×§×• ×¢×œ ×“×£; ×¢×¦×/×™ ×¢×™×Ÿ ××—×ª ×•×”×–×™×–/×™ ××ª ×”×“×£ ×¢×“ ×©×”× ×§×•×“×” × ×¢×œ××ª â€“ ×›×š ××–×”×™× ××ª × ×§×•×“×ª ×”×¢×™×•×•×¨×•×Ÿ." },
            { title: "ğŸ‘‚ ×¨×¤×œ×§×¡ ×¤×™×§×”", how: "×§×™×©×¨×• ×‘×¢×“×™× ×•×ª ××ª×—×ª ×œ×¤×™×§×ª ×”×‘×¨×š (×¢× ×¤×˜×™×© ×’×•××™) ×•×¦×¤×• ×‘×¨×’×œ ×§×•×¤×¦×ª â€“ ××¡×œ×•×œ ×¨×¤×œ×§×¡ ×§×¦×¨." },
            { title: "ğŸ–ï¸ ×”×ª×××ª ××¦×‘×¢-××£", how: "×‘×¢×™× ×™×™× ×¢×¦×•××•×ª × ×¡×• ×œ×’×¢×ª ×‘××£ â€“ ××¨×’×™×©×™× ××ª ×ª×¤×§×™×“ ×”××•×—×•×Ÿ ×‘×“×™×•×§ ×”×ª× ×•×¢×”." },
        ];

        // ---------- STATE ----------
        const state = { tab: "cells", level: "kids", query: "", filters: new Set(), prog: JSON.parse(localStorage.getItem('brainlab_prog') || '{}'), anim: true };

        // ---------- HELPERS ----------
        const $ = s => document.querySelector(s);
        const $$ = s => Array.from(document.querySelectorAll(s));

        function render() {
            // Level buttons
            $$("[data-level]").forEach(b => b.classList.toggle("active", b.dataset.level === state.level));
            // Tab selection
            $$(".tab").forEach(t => t.setAttribute("aria-selected", String(t.dataset.tab === state.tab)));

            // Dataset
            let data = state.tab === "cells" ? cells : state.tab === "regions" ? regions : state.tab === "systems" ? systems : state.tab === "activities" ? [] : [];

            // Filters & search
            const q = state.query.toLowerCase();
            data = data.filter(item => {
                const matchesQ = !q || (item.title + " " + (item.tags || []).join(" ") + Object.values(item.text || {}).join(" ")).toLowerCase().includes(q);
                const f = state.filters; if (!f.size) return matchesQ;
                return matchesQ && ((item.kind || []).some(k => f.has(k) || f.has(item.id)) || f.has(item.id));
            });

            const frag = document.createDocumentFragment();
            const wrap = document.createElement('div');
            wrap.className = 'kiosk';

            // Regions map visibility
            $("#mapWrap").hidden = state.tab !== "regions";
            $("#tracksWrap").hidden = state.tab !== "tracks";

            // Content zones
            if (state.tab !== "activities" && state.tab !== "tracks") { // cards mode
                const grid = document.createElement('div'); grid.className = 'cards';
                data.forEach(item => grid.appendChild(cardFor(item)));
                if (!data.length) { const empty = document.createElement('div'); empty.className = 'panel'; empty.innerHTML = '<strong>×œ× × ××¦××• ×ª×•×¦××•×ª.</strong> × ×¡×• ×œ×”×¡×™×¨ ×¡×™× ×•× ×™× ××• ×œ×©× ×•×ª ×’×™×œ.'; wrap.appendChild(empty); }
                wrap.appendChild(grid);
            } else if (state.tab === "activities") {
                wrap.appendChild(activityZone());
            } else if (state.tab === "tracks") {
                buildTracks();
            }

            $("#content").replaceChildren(frag, wrap);
            revealNow($("#content"));
            updateProgressUI();
        }

        function cardFor(item) {
            const card = document.createElement('article'); card.className = 'card reveal';
            const pill = document.createElement('div'); pill.className = 'pill'; pill.textContent = item.tags?.[0] || '××™×“×¢';
            const h = document.createElement('h4'); h.textContent = item.title;
            const p = document.createElement('p'); p.textContent = getText(item);
            const tags = document.createElement('div'); tags.className = 'tags';
            (item.tags || []).forEach(t => { const s = document.createElement('span'); s.className = 'tag'; s.textContent = t; tags.appendChild(s); });
            card.append(pill, h, p, tags);
            card.addEventListener('click', () => markDone(item.id));
            return card;
        }

        function getText(item) {
            const t = item.text || {};
            switch (state.level) {
                case 'kids': return t.kids || t.elem || t.teen || t.pro || '';
                case 'elem': return t.elem || t.teen || t.pro || t.kids || '';
                case 'teen': return t.teen || t.pro || t.elem || t.kids || '';
                case 'pro': return t.pro || t.teen || t.elem || t.kids || '';
                default: return t.elem || '';
            }
        }

        function activityZone() {
            const wrap = document.createElement('div');
            wrap.className = 'grid';
            activities.forEach(ac => {
                const section = document.createElement('section'); section.className = 'panel reveal';
                section.innerHTML = `<h3>${ac.title}</h3>`;
                ac.q.forEach((q, i) => {
                    const block = document.createElement('div'); block.className = 'panel'; block.style.background = '#0f1434';
                    const qEl = document.createElement('p'); qEl.textContent = `â“ ${q.t}`;
                    const list = document.createElement('div'); list.className = 'chips';
                    q.a.forEach((ans, idx) => {
                        const b = document.createElement('button'); b.className = 'btn small'; b.textContent = ans;
                        b.addEventListener('click', () => {
                            if (idx === q.ok) { b.classList.add('active'); b.textContent = 'âœ… ' + ans; markDone(ac.id + "_" + i); } else { b.style.borderColor = 'var(--danger)'; b.textContent = 'âŒ ' + ans; }
                            // lock
                            Array.from(list.children).forEach(x => x.disabled = true);
                        });
                        list.appendChild(b);
                    });
                    block.append(qEl, list); section.append(block);
                });
                wrap.append(section);
            });
            return wrap;
        }

        function buildTracks() {
            const holder = document.getElementById('tracksCards');
            holder.replaceChildren();
            tracks.forEach(t => {
                const card = document.createElement('article'); card.className = 'card reveal';
                const h = document.createElement('h4'); h.textContent = `${t.age} â€“ ×ª×•×›× ×™×ª ×§×¦×¨×”`;
                const ul = document.createElement('ul');
                t.steps.forEach(s => { const li = document.createElement('li'); li.textContent = 'â€¢ ' + s; ul.appendChild(li); });
                const btn = document.createElement('button'); btn.className = 'btn'; btn.textContent = 'ğŸ ×¡××Ÿ ××¡×œ×•×œ ×”×•×©×œ×';
                btn.addEventListener('click', () => { markDone(t.id); btn.textContent = 'âœ… ×”×•×©×œ×'; btn.disabled = true; });
                card.append(h, ul, btn); holder.append(card);
            });
        }

        // ---------- PROGRESS ----------
        function markDone(key) { state.prog[key] = true; persistProg(); updateProgressUI(); }
        function persistProg() { localStorage.setItem('brainlab_prog', JSON.stringify(state.prog)); }
        function updateProgressUI() {
            const total = cells.length + regions.length + systems.length + activities.reduce((s, a) => s + a.q.length, 0) + tracks.length;
            const done = Object.keys(state.prog).length;
            const pct = Math.round((done / total) * 100);
            $('#progBar').style.width = Math.min(100, pct) + "%";
            $('#progTxt').textContent = `${pct}% ×”×•×©×œ×`;
        }

        // ---------- EVENTS ----------
        $$("[data-level]").forEach(btn => btn.addEventListener('click', () => { state.level = btn.dataset.level; render(); }));
        $$(".tab").forEach(tab => tab.addEventListener('click', () => { state.tab = tab.dataset.tab; render(); }));
        $$("[data-filter]").forEach(btn => btn.addEventListener('click', () => { const k = btn.dataset.filter; if (state.filters.has(k)) state.filters.delete(k); else state.filters.add(k); btn.setAttribute('aria-pressed', String(state.filters.has(k))); btn.classList.toggle('active'); render(); }));
        $("#q").addEventListener('input', e => { state.query = e.target.value; render(); });
        $("#clear").addEventListener('click', () => { state.query = ''; $("#q").value = ''; render(); });
        $("#animTgl").addEventListener('change', e => { state.anim = e.target.checked; toggleAnim(); });

        // Brain grid interactions
        $$("#brainGrid .cell").forEach(c => {
            c.addEventListener('click', () => {
                $$("#brainGrid .cell").forEach(x => x.classList.remove('active'));
                c.classList.add('active');
                const id = c.dataset.region; state.tab = 'regions'; state.filters = new Set([id]);
                $$("[data-filter]").forEach(b => { b.classList.toggle('active', state.filters.has(b.dataset.filter)); b.setAttribute('aria-pressed', String(state.filters.has(b.dataset.filter))); });
                render();
            });
        });

        // Dialogs
        const dlgGloss = document.getElementById('dlgGloss');
        const dlgExps = document.getElementById('dlgExps');
        $$('[data-open="gloss"]').forEach(b => b.addEventListener('click', () => { $('#glossBody').innerHTML = glossary.map(g => `<p><strong>${g.term}</strong> â€” ${g.def}</p>`).join(''); dlgGloss.showModal(); }));
        $$('[data-open="exps"]').forEach(b => b.addEventListener('click', () => { $('#expsBody').innerHTML = experiments.map(e => `<p><strong>${e.title}</strong><br>${e.how}</p>`).join(''); dlgExps.showModal(); }));
        $$('dialog [data-close]').forEach(b => b.addEventListener('click', e => e.target.closest('dialog').close()));

        // ---------- ANIMATIONS ----------
        // Reveal on view
        const io = new IntersectionObserver((ents) => {
            ents.forEach(e => { if (e.isIntersecting) e.target.classList.add('on'); });
        }, { threshold: .12 });
        function revealNow(root) { $$('.reveal', root).forEach(el => io.observe(el)); }

        // Three.js background
        let renderer, scene, camera, animId; let particles;
        function initThree() {
            const canvas = document.getElementById('neuroBG');
            const w = canvas.clientWidth = canvas.parentElement.clientWidth;
            const h = canvas.clientHeight = 220;
            renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
            renderer.setSize(w, h, false);
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, w / h, 0.1, 100); camera.position.z = 18; scene.add(camera);
            const g = new THREE.BufferGeometry();
            const COUNT = 220; const pos = new Float32Array(COUNT * 3);
            for (let i = 0; i < COUNT; i++) { pos[i * 3 + 0] = (Math.random() - 0.5) * 24; pos[i * 3 + 1] = (Math.random() - 0.5) * 10; pos[i * 3 + 2] = (Math.random() - 0.5) * 8; }
            g.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            const m = new THREE.PointsMaterial({ size: 0.06, color: 0x8ab4ff });
            particles = new THREE.Points(g, m); scene.add(particles);
            const light = new THREE.AmbientLight(0x6699ff, .6); scene.add(light);
            const light2 = new THREE.PointLight(0x00e1d6, .8); light2.position.set(3, 4, 6); scene.add(light2);
            animate();
            window.addEventListener('resize', onResize);
        }
        function onResize() { if (!renderer) return; const canvas = renderer.domElement; const w = canvas.parentElement.clientWidth; const h = 220; renderer.setSize(w, h, false); camera.aspect = w / h; camera.updateProjectionMatrix(); }
        function animate() { if (!state.anim) return; animId = requestAnimationFrame(animate); particles.rotation.y += 0.0015; particles.rotation.x += 0.0008; renderer.render(scene, camera); }
        function stopAnim() { if (animId) cancelAnimationFrame(animId); animId = null; }
        function toggleAnim() { if (state.anim) { animate(); } else { stopAnim(); } }

        // ---------- INIT ----------
        render();
        initThree();
    </script>
</body>

</html>